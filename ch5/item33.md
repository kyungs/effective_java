# 아이템33. 타입 안전 이종 컨테이너를 고려하라

<pre>
*참고*
Container  
크기가 한번 정해지면 바꿀 수 없는 배열의 단점을 보완.  
Collection(List, Queue, Set)과 Map으로 나뉨.
</pre>

하나의 컨테이너에서 매개변수화할 수 있는 타입의 수가 제한된다.
> Set<E>에는 우너소의 타입을 뜻하는 단 하나의 타입 매개변수만 있으면 된다.

### 타입 안전 이종 컨테이너 패턴
더 유연한 수단이 필요할 때 컨테이너 대신 키를 매개변수화한 다음, 컨테이너에 값을 넣거나 뺄 때 매개변수화한 키를 함께 제공하면 된다.  

#### 타입 안전 이종 컨테이너 패턴으로 작성한 Favorites 클래스
* 타입 토큰: 컴파일타임 타입 정보와 런타임 타입 정보를 알아내기 위해 메서드들이 주고 받는 class 리터럴
* Favorites class의 인스턴스는 타입 안전하다.   
또, 모든 키의 타입이 제각각이라 일반적인 맵과 달리 여러가지 타입의 원소를 담을 수 있다.  
* 이 맵은 키와 값 사이의 타입 관계를 보증하지 않는다.

##### Favorites 클래스의 제약
1. class 객체를 (제네릭이 아닌) 로 타입으로 넘기면 Favorites 인스턴스의 타입 안전성이 쉽게 깨진다.   
일반 컬렉션 구현체도 로 타입을 사용하면 타입 안전성이 깨진다.  
Favorites가 타입 불변식을 어기는 일이 없도록 보장하려면 putFavorite 메서드에서 인수로 주어진 instance의 타입이 type으로 명시한 타입과 같은지 확인하면 된다.   
2. 실체화 불가 타입에는 사용할 수 없다.  

##### getFavorite과 putFavorite이 허용하는 타입을 제한하고 싶을 때, 한정적 타입 토큰을 활용하라
* 한정적 타입 토큰: 단순히 한정적 타입 매개변수나 한정적 와일드카드를 사용하여 표현 가능한 타입을 제한하는 타입 토큰  

##### Class<?> 타입의 객체를 한정적 타입 토큰을 받는 메서드에 넘기려면?   
* asSubClass: Class<?> 타입의 객체를 Class<? extends Annotation>으로 안전하게 형변환해주는 Class 클래스의 메소드   

## 핵심 정리
* 컨테이너 자체가 아닌 키를 타입 매개변수로 바꾸면 타입 안전 이종 컨테이너를 만들 수 있다.
* 타입 안전 이종 컨테이너는 Class를 키로 쓰며, 이런 식으로 쓰이는 Class 객체를 타입 토큰이라 한다. 직접 수현한 키 타입도 쓸 수 있다.  
